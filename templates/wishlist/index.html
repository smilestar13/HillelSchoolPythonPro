{% extends 'base.html' %}
{% load static %}

{% block title %}Список бажань{% endblock title %}
{% block body_class %}favourites{% endblock body_class %}

{% block main %}
    <div class="col-12 my-3 my-lg-5" style="background-color: #FFC107;">
        {% if wish_items %}
            {% for item in wish_items %}
                <div class="row g-0 bg-body-secondary position-relative">
                    {% if item.product.image %}
                        <div class="col-md-6 mb-md-0 p-md-4" style="background-color: #FFC107;">
                            <img src="{{ item.product.image.url }}" class="w-100"
                                 alt="product" style="max-height: 200px; object-fit: contain;">
                        </div>
                    {% else %}
                        <div class="col-md-6 mb-md-0 p-md-4" style="background-color: #FFC107;">
                            <img src="{% static "images/no-images.png" %}" class="w-100"
                                 alt="product"
                                 style="max-height: 200px; object-fit: contain;">
                        </div>
                    {% endif %}

                    <div class="col-md-6 p-4 ps-md-0" style="background-color: #FFC107;">
                        <h5 class="mt-0">{{ item.product.name }}
                        </h5>
                        <p>{{ item.product.description|truncatewords:50 }}</p>
                        <p class="card-price">{{ item.product.price }}$</p>

                        <div class="container text-center">
                            <div class="row">
                                <div class="col-3">
                                    <form method="post" action="{% url 'wish_list_action' 'remove' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="product_id"
                                               value="{{ item.product.id }}">
                                        <input type="submit" value="Видалити"
                                               class="btn btn-danger w-100">
                                    </form>
                                </div>
                                <div class="col-9">
                                    <form method="post" action="{% url 'order_action' 'add' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="product_id"
                                               value="{{ item.product.id }}">
                                        <input type="submit" value="Додати до кошику"
                                               class="btn btn-success w-100">
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

            {% endfor %}
            <tr>

                <td>Total: <span
                        class="small">(including discount)</span></td>
                <td>{{ wish_list.total_amount }}</td>
            </tr>
            </tbody>
            <tr>
                <td></td>
                <td></td>
                {% if not order.discount %}
                    <td><label for="id_discount">Have a discount code?
                        Please enter
                        here.</label></td>
                    <td><input class="form-control" id="id_discount"
                               type="text"
                               name="discount"></td>
                {% else %}
                    <td colspan="2">You already applied discount.</td>
                {% endif %}
                <td><input type="submit" class="btn btn-warning"
                           value="Recalculate"></td>
            </tr>
            </table>
            </form>

            <div class="row">
                <div class="col-3">
                    <form method="post" action="{% url 'wish_list_action' 'clear' %}">
                        {% csrf_token %}
                        <input type="submit" value="Очистити бажання" class="btn btn-danger w-100">
                    </form>
                </div>
                <div class="col-9">
                    <form method="post" action="{% url 'wish_list_action' 'pay' %}">
                        {% csrf_token %}
                        <input type="submit" value="Придбати все" class="btn btn-success w-100">
                    </form>
                </div>
            </div>

            {% if form.errors %}
                <div class="mb-2">
                    <ul>
                        {% for error in form.errors %}
                            <li class="text-danger small">{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
            {% if form.non_field_errors %}
                <div class="mb-2">
                    <ul>
                        {% for error in form.non_field_errors %}
                            <li class="text-danger small">{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        {% else %}
            <h2>Мрієте щось замовити?</h2>
            <p><a href="{% url 'products' %}">Додати товар.</a></p>
        {% endif %}
    </div>
{% endblock main %}